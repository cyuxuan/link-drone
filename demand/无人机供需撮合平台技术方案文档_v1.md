# 无人机供需撮合平台技术方案文档

## 一、项目概述

### 1.1 项目背景

随着无人机技术的快速发展和应用场景的不断拓展，无人机在航拍、货运、巡检等领域的需求日益增长。然而，无人机资源分布不均、信息不对称、服务标准不统一等问题制约了行业发展。本平台旨在搭建无人机供需双方的桥梁，通过技术手段实现资源高效匹配，提升行业服务水平，促进无人机共享经济发展。

### 1.2 项目目标

1. 构建无人机供需撮合平台，实现供给方与需求方的精准匹配
2. 提供全流程服务保障，确保交易安全、合规、高效
3. 建立行业服务标准，提升用户体验和满意度
4. 实现平台可持续运营，形成良性商业生态

### 1.3 系统用户角色

- **资源供给方**：拥有无人机设备和操作资质的个人或企业
- **需求方**：有无人机使用需求的个人或企业
- **平台运营方**：负责平台运营、审核、监管的管理团队

## 二、系统架构设计

### 2.1 总体架构

采用前后端分离的微服务架构，主要包括以下几个部分：

1. **前端应用层**：基于UniApp开发的跨平台应用，支持iOS、Android、H5等多端
2. **API网关层**：统一接口管理，负责请求路由、限流、认证等
3. **业务服务层**：基于Spring Boot的微服务集群，实现核心业务逻辑
4. **数据存储层**：关系型数据库与NoSQL数据库结合使用
5. **中间件层**：消息队列、缓存、搜索引擎等支撑服务
6. **基础设施层**：云服务器、对象存储、CDN等基础设施

### 2.2 技术选型

#### 2.2.1 前端技术栈

- **开发框架**：UniApp（基于Vue.js的跨端开发框架）
- **UI组件库**：uView UI
- **状态管理**：Vuex
- **地图服务**：高德地图API
- **即时通讯**：WebSocket + 融云IM SDK
- **数据可视化**：ECharts

#### 2.2.2 后端技术栈

- **开发框架**：Spring Boot 2.7.x
- **微服务框架**：Spring Cloud Alibaba
- **服务注册与发现**：Nacos
- **配置中心**：Nacos Config
- **网关**：Spring Cloud Gateway
- **服务调用**：OpenFeign
- **负载均衡**：Spring Cloud LoadBalancer
- **熔断降级**：Sentinel
- **分布式事务**：Seata
- **消息队列**：RocketMQ
- **缓存**：Redis
- **搜索引擎**：Elasticsearch
- **数据库**：MySQL 8.0
- **ORM框架**：MyBatis-Plus
- **分库分表**：Sharding-JDBC
- **对象存储**：阿里云OSS
- **短信服务**：阿里云SMS
- **支付服务**：微信支付、支付宝

#### 2.2.3 DevOps工具链

- **代码管理**：Git + GitLab
- **CI/CD**：Jenkins
- **容器化**：Docker
- **编排工具**：Kubernetes
- **监控系统**：Prometheus + Grafana
- **日志收集**：ELK Stack

## 三、前端架构设计

### 3.1 应用架构

基于UniApp框架开发，实现一次开发，多端部署（iOS、Android、H5、小程序等）。采用组件化、模块化的开发方式，提高代码复用性和可维护性。

### 3.2 目录结构

```
├── src
│   ├── api                 # API接口封装
│   ├── components          # 公共组件
│   ├── pages               # 页面文件
│   │   ├── index           # 首页
│   │   ├── user            # 用户中心
│   │   ├── supply          # 供给方模块
│   │   ├── demand          # 需求方模块
│   │   ├── order           # 订单模块
│   │   └── message         # 消息模块
│   ├── static              # 静态资源
│   ├── store               # Vuex状态管理
│   ├── utils               # 工具函数
│   ├── App.vue             # 应用入口组件
│   ├── main.js             # 应用入口JS
│   ├── manifest.json       # 应用配置
│   ├── pages.json          # 页面路由配置
│   └── uni.scss            # 全局样式变量
└── package.json            # 项目依赖
```

### 3.3 核心功能模块

#### 3.3.1 用户认证模块

- 登录注册：手机号+验证码、第三方登录（微信、支付宝）
- 实名认证：个人身份认证、企业认证
- 资质认证：无人机操作证、设备登记证上传与验证

#### 3.3.2 供给方模块

- 服务信息发布：设备信息、服务范围、价格设置
- 接单管理：订单接收、确认、执行、完成
- 收益管理：收益统计、提现申请、账单查询

#### 3.3.3 需求方模块

- 需求发布：服务类型选择、时间地点设置、预算填写
- 供应商筛选：多维度筛选、评价查看、在线沟通
- 支付结算：在线支付、分阶段付款、发票申请

#### 3.3.4 订单管理模块

- 订单创建：需求确认、协议签署、预付款支付
- 订单执行：服务进度跟踪、实时位置共享
- 订单完成：服务验收、评价反馈、售后处理

#### 3.3.5 LBS服务模块

- 位置服务：实时定位、地图选点、距离计算
- 区域管理：服务区域圈选、禁飞区标注
- 智能匹配：基于位置的供需匹配推荐

#### 3.3.6 即时通讯模块

- 消息列表：会话管理、未读消息提醒
- 聊天界面：文字、图片、位置信息发送
- 系统通知：订单状态变更、平台公告推送

#### 3.3.7 支付模块

- 支付方式：微信支付、支付宝、银行卡
- 资金管理：预付款托管、分阶段释放
- 发票管理：发票申请、开具、查询

### 3.4 UI/UX设计原则

- **简洁直观**：界面简洁清晰，操作流程直观易懂
- **一致性**：保持视觉元素、交互方式的一致性
- **响应式**：适配不同尺寸的移动设备屏幕
- **用户反馈**：操作后给予明确的反馈，提升用户体验
- **无障碍设计**：考虑不同用户群体的使用需求

## 四、后端架构设计

### 4.1 微服务架构

采用基于Spring Cloud Alibaba的微服务架构，将系统拆分为多个独立部署、独立运行的微服务，提高系统的可扩展性和可维护性。

### 4.2 服务划分

```
├── drone-system-gateway           # API网关服务
├── drone-system-auth              # 认证授权服务
├── drone-system-user              # 用户服务
├── drone-system-supply            # 供给方服务
├── drone-system-demand            # 需求方服务
├── drone-system-order             # 订单服务
├── drone-system-payment           # 支付服务
├── drone-system-message           # 消息服务
├── drone-system-file              # 文件服务
├── drone-system-search            # 搜索服务
├── drone-system-monitor           # 监控服务
└── drone-system-admin             # 管理后台服务
```

### 4.3 核心服务功能

#### 4.3.1 API网关服务

- 请求路由：根据配置将请求转发到相应的微服务
- 认证鉴权：统一身份认证和权限控制
- 限流熔断：防止服务过载，提高系统稳定性
- 日志监控：记录请求日志，监控系统运行状态

#### 4.3.2 认证授权服务

- 用户认证：账号密码认证、手机验证码认证、第三方登录
- 令牌管理：JWT令牌生成、验证、刷新
- 权限控制：基于RBAC的权限管理
- 安全防护：防止CSRF、XSS等安全攻击

#### 4.3.3 用户服务

- 用户管理：用户注册、信息维护、状态管理
- 实名认证：个人身份认证、企业认证
- 资质认证：无人机操作证、设备登记证验证
- 信用评价：用户信用分计算、评价管理

#### 4.3.4 供给方服务

- 服务管理：服务信息发布、修改、下架
- 设备管理：无人机设备信息管理
- 接单管理：订单接收、确认、拒绝
- 收益管理：收益统计、提现申请

#### 4.3.5 需求方服务

- 需求管理：需求发布、修改、取消
- 供应商筛选：多维度筛选、排序
- 服务评价：服务完成后的评价反馈
- 收藏管理：收藏供应商、服务套餐

#### 4.3.6 订单服务

- 订单创建：基于需求和供给信息创建订单
- 订单状态管理：状态变更、流程控制
- 订单跟踪：服务进度跟踪、位置共享
- 订单验收：服务验收确认、质量评价

#### 4.3.7 支付服务

- 支付渠道：对接微信支付、支付宝等支付渠道
- 交易管理：交易创建、查询、退款
- 资金托管：预付款托管、分阶段释放
- 对账结算：平台抽成计算、供给方结算

#### 4.3.8 消息服务

- 即时通讯：WebSocket实时消息推送
- 消息存储：历史消息存储与查询
- 系统通知：订单状态变更、平台公告推送
- 消息队列：异步消息处理

#### 4.3.9 文件服务

- 文件上传：图片、视频、文档上传
- 文件存储：对接阿里云OSS存储服务
- 文件处理：图片压缩、水印添加
- 文件安全：病毒扫描、敏感内容检测

#### 4.3.10 搜索服务

- 全文搜索：基于Elasticsearch的全文搜索
- 地理位置搜索：基于位置的服务查询
- 智能推荐：个性化服务推荐
- 搜索优化：搜索结果排序优化

### 4.4 数据库设计

#### 4.4.1 关系型数据库（MySQL）

主要存储结构化数据，包括：

- 用户信息表
- 设备信息表
- 服务信息表
- 需求信息表
- 订单信息表
- 交易记录表
- 评价信息表
- 系统配置表

#### 4.4.2 NoSQL数据库（Redis）

主要用于缓存和临时数据存储，包括：

- 用户会话信息
- 热点数据缓存
- 接口限流计数
- 排行榜数据

#### 4.4.3 搜索引擎（Elasticsearch）

主要用于全文搜索和地理位置搜索，包括：

- 服务信息索引
- 需求信息索引
- 用户信息索引
- 订单信息索引

### 4.5 接口设计

采用RESTful API设计风格，主要包括以下接口类型：

- 用户认证接口：登录、注册、认证
- 用户信息接口：个人信息、企业信息
- 供给方接口：服务发布、接单管理
- 需求方接口：需求发布、供应商筛选
- 订单接口：订单创建、状态管理、验收
- 支付接口：支付、退款、结算
- 消息接口：即时通讯、系统通知
- 文件接口：上传、下载、预览
- 搜索接口：全文搜索、地理位置搜索

## 五、数据库模型设计

### 5.1 核心数据表

#### 5.1.1 用户表（user）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_type | tinyint | 用户类型（1:个人,2:企业） |
| username | varchar(50) | 用户名 |
| password | varchar(100) | 密码（加密存储） |
| phone | varchar(20) | 手机号 |
| email | varchar(100) | 邮箱 |
| real_name | varchar(50) | 真实姓名 |
| id_card | varchar(20) | 身份证号 |
| company_name | varchar(100) | 企业名称 |
| business_license | varchar(100) | 营业执照号 |
| credit_score | int | 信用分 |
| status | tinyint | 状态（0:禁用,1:正常） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.2 资质认证表（qualification）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| cert_type | tinyint | 证书类型（1:操作证,2:设备登记证） |
| cert_no | varchar(50) | 证书编号 |
| cert_image | varchar(200) | 证书图片URL |
| valid_start | date | 有效期开始日期 |
| valid_end | date | 有效期结束日期 |
| status | tinyint | 状态（0:待审核,1:已通过,2:未通过） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.3 设备表（device）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| device_name | varchar(100) | 设备名称 |
| device_model | varchar(100) | 设备型号 |
| device_sn | varchar(100) | 设备序列号 |
| register_no | varchar(100) | 登记证编号 |
| device_type | tinyint | 设备类型（1:航拍,2:货运,3:多功能） |
| max_load | decimal(10,2) | 最大载重（kg） |
| max_flight_time | int | 最大飞行时间（分钟） |
| max_flight_distance | int | 最大飞行距离（米） |
| device_image | varchar(200) | 设备图片URL |
| status | tinyint | 状态（0:禁用,1:正常） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.4 服务信息表（service）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| device_id | bigint | 设备ID |
| service_type | tinyint | 服务类型（1:航拍,2:货运,3:巡检） |
| service_name | varchar(100) | 服务名称 |
| service_desc | text | 服务描述 |
| price_type | tinyint | 计价方式（1:按小时,2:按次,3:按里程） |
| price | decimal(10,2) | 价格 |
| service_area | geometry | 服务区域（地理坐标） |
| service_time | varchar(200) | 服务时间（JSON格式） |
| status | tinyint | 状态（0:下架,1:上架） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.5 需求信息表（demand）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| demand_type | tinyint | 需求类型（1:航拍,2:货运,3:巡检） |
| demand_title | varchar(100) | 需求标题 |
| demand_desc | text | 需求描述 |
| location | point | 需求位置（地理坐标） |
| address | varchar(200) | 详细地址 |
| start_time | datetime | 开始时间 |
| end_time | datetime | 结束时间 |
| budget | decimal(10,2) | 预算 |
| is_urgent | tinyint | 是否加急（0:否,1:是） |
| status | tinyint | 状态（0:已取消,1:待匹配,2:已匹配,3:已完成） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.6 订单表（order）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| order_no | varchar(50) | 订单编号 |
| demand_id | bigint | 需求ID |
| service_id | bigint | 服务ID |
| demand_user_id | bigint | 需求方用户ID |
| supply_user_id | bigint | 供给方用户ID |
| order_type | tinyint | 订单类型（1:航拍,2:货运,3:巡检） |
| order_amount | decimal(10,2) | 订单金额 |
| platform_fee | decimal(10,2) | 平台服务费 |
| prepay_amount | decimal(10,2) | 预付款金额 |
| remain_amount | decimal(10,2) | 剩余款项 |
| start_time | datetime | 服务开始时间 |
| end_time | datetime | 服务结束时间 |
| status | tinyint | 状态（0:已取消,1:待支付,2:待确认,3:进行中,4:待验收,5:已完成） |
| cancel_reason | varchar(200) | 取消原因 |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.7 支付记录表（payment）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| order_id | bigint | 订单ID |
| user_id | bigint | 用户ID |
| payment_no | varchar(50) | 支付流水号 |
| payment_type | tinyint | 支付类型（1:微信,2:支付宝,3:银行卡） |
| payment_amount | decimal(10,2) | 支付金额 |
| payment_status | tinyint | 支付状态（0:失败,1:成功,2:处理中） |
| payment_purpose | tinyint | 支付用途（1:预付款,2:尾款,3:全款,4:退款） |
| transaction_id | varchar(100) | 第三方交易ID |
| payment_time | datetime | 支付时间 |
| callback_time | datetime | 回调时间 |
| callback_content | text | 回调内容（JSON格式） |
| remark | varchar(200) | 备注 |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.8 评价表（evaluation）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| order_id | bigint | 订单ID |
| from_user_id | bigint | 评价用户ID |
| to_user_id | bigint | 被评价用户ID |
| user_type | tinyint | 用户类型（1:需求方,2:供给方） |
| score | int | 评分（1-5） |
| content | varchar(500) | 评价内容 |
| images | varchar(500) | 评价图片（JSON数组） |
| reply_content | varchar(500) | 回复内容 |
| reply_time | datetime | 回复时间 |
| status | tinyint | 状态（0:待审核,1:已通过,2:未通过） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.9 消息表（message）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| session_id | varchar(50) | 会话ID |
| from_user_id | bigint | 发送用户ID |
| to_user_id | bigint | 接收用户ID |
| message_type | tinyint | 消息类型（1:文本,2:图片,3:语音,4:位置,5:系统通知） |
| content | text | 消息内容 |
| media_url | varchar(200) | 媒体文件URL |
| location | point | 位置信息（地理坐标） |
| read_status | tinyint | 读取状态（0:未读,1:已读） |
| send_time | datetime | 发送时间 |
| read_time | datetime | 读取时间 |
| status | tinyint | 状态（0:发送失败,1:发送成功,2:已撤回） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.10 会话表（chat_session）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | varchar(50) | 主键ID（会话ID） |
| user_id_1 | bigint | 用户1ID |
| user_id_2 | bigint | 用户2ID |
| last_message_id | bigint | 最后一条消息ID |
| last_message_content | varchar(200) | 最后一条消息内容 |
| last_message_time | datetime | 最后一条消息时间 |
| unread_count_1 | int | 用户1未读消息数 |
| unread_count_2 | int | 用户2未读消息数 |
| status | tinyint | 状态（0:禁用,1:正常） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

#### 5.1.11 系统通知表（system_notification）

| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | bigint | 主键ID |
| user_id | bigint | 接收用户ID（0表示全部用户） |
| title | varchar(100) | 通知标题 |
| content | text | 通知内容 |
| notification_type | tinyint | 通知类型（1:系统公告,2:订单通知,3:活动通知,4:安全提醒） |
| related_id | varchar(50) | 关联ID（如订单ID） |
| read_status | tinyint | 读取状态（0:未读,1:已读） |
| push_status | tinyint | 推送状态（0:未推送,1:已推送） |
| push_time | datetime | 推送时间 |
| read_time | datetime | 读取时间 |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

### 5.2 数据库索引设计

- 用户表：手机号唯一索引、邮箱唯一索引
- 资质认证表：用户ID索引、证书编号索引
- 设备表：用户ID索引、设备序列号唯一索引
- 服务信息表：用户ID索引、设备ID索引、服务区域空间索引
- 需求信息表：用户ID索引、需求位置空间索引
- 订单表：订单编号唯一索引、需求ID索引、服务ID索引
- 支付记录表：订单ID索引、支付流水号唯一索引
- 评价表：订单ID索引、评价用户ID索引、被评价用户ID索引

### 5.3 数据库表关系设计

#### 5.3.1 ER图

```
+-------------+       +----------------+       +------------+
|    user     |<------| qualification  |       |   device   |<-----+
+-------------+       +----------------+       +------------+      |
      ^                                              ^             |
      |                                              |             |
      |                                              |             |
      |                                              |             |
      |                +------------+          +------------+      |
      +--------------->|  demand    |          |  service   |------+
      |                +------------+          +------------+
      |                      |                       |
      |                      v                       v
      |                +---------------------------+
      +----------------|         order            |
      |                +---------------------------+
      |                            |
      |                            v
      |                +---------------------------+
      |                |        payment           |
      |                +---------------------------+
      |
      |                +---------------------------+
      +--------------->|       evaluation         |
                       +---------------------------+
```

#### 5.3.2 表关系说明

1. **用户表(user)与其他表的关系**：
   - 一个用户可以有多个资质认证（一对多）
   - 一个用户可以拥有多个设备（一对多）
   - 一个用户可以发布多个服务（一对多）
   - 一个用户可以发布多个需求（一对多）
   - 一个用户可以参与多个订单（一对多）
   - 一个用户可以有多条评价记录（一对多）

2. **设备表(device)与服务表(service)的关系**：
   - 一个设备可以提供多个服务（一对多）

3. **服务表(service)与订单表(order)的关系**：
   - 一个服务可以关联多个订单（一对多）

4. **需求表(demand)与订单表(order)的关系**：
   - 一个需求可以关联一个订单（一对一）

5. **订单表(order)与支付表(payment)的关系**：
   - 一个订单可以有多条支付记录（一对多，考虑到预付款、尾款等多次支付场景）

6. **订单表(order)与评价表(evaluation)的关系**：
   - 一个订单可以有多条评价记录（一对多，供需双方互评）

#### 5.3.3 外键约束

为保证数据一致性，主要外键约束如下：

1. **资质认证表(qualification)**：
   - `user_id` 外键关联 `user.id`

2. **设备表(device)**：
   - `user_id` 外键关联 `user.id`

3. **服务表(service)**：
   - `user_id` 外键关联 `user.id`
   - `device_id` 外键关联 `device.id`

4. **需求表(demand)**：
   - `user_id` 外键关联 `user.id`

5. **订单表(order)**：
   - `demand_id` 外键关联 `demand.id`
   - `service_id` 外键关联 `service.id`
   - `demand_user_id` 外键关联 `user.id`
   - `supply_user_id` 外键关联 `user.id`

6. **支付表(payment)**：
   - `order_id` 外键关联 `order.id`
   - `user_id` 外键关联 `user.id`

7. **评价表(evaluation)**：
   - `order_id` 外键关联 `order.id`
   - `from_user_id` 外键关联 `user.id`
   - `to_user_id` 外键关联 `user.id`

## 六、API接口规范

### 6.1 接口通用规范

#### 6.1.1 请求格式

- 接口URL格式：`/api/{版本}/{模块}/{资源}/{操作}`
- HTTP方法：GET（查询）、POST（创建）、PUT（更新）、DELETE（删除）
- 请求头：Content-Type: application/json
- 请求参数：JSON格式

#### 6.1.2 响应格式

```json
{
  "code": 200,           // 状态码
  "message": "success",  // 状态描述
  "data": {},            // 响应数据
  "timestamp": 1629782400000  // 时间戳
}
```

#### 6.1.3 状态码

- 200：成功
- 400：请求参数错误
- 401：未授权
- 403：权限不足
- 404：资源不存在
- 500：服务器内部错误

### 6.2 核心接口定义

#### 6.2.1 用户认证接口

- 登录：POST /api/v1/auth/login
- 注册：POST /api/v1/auth/register
- 发送验证码：POST /api/v1/auth/sendCode
- 刷新令牌：POST /api/v1/auth/refreshToken
- 退出登录：POST /api/v1/auth/logout

#### 6.2.2 用户信息接口

- 获取用户信息：GET /api/v1/user/info
- 更新用户信息：PUT /api/v1/user/info
- 实名认证：POST /api/v1/user/realNameAuth
- 企业认证：POST /api/v1/user/companyAuth
- 上传资质证书：POST /api/v1/user/qualification

#### 6.2.3 设备管理接口

- 添加设备：POST /api/v1/device
- 更新设备：PUT /api/v1/device/{id}
- 删除设备：DELETE /api/v1/device/{id}
- 设备列表：GET /api/v1/device/list
- 设备详情：GET /api/v1/device/{id}

#### 6.2.4 服务管理接口

- 发布服务：POST /api/v1/service
- 更新服务：PUT /api/v1/service/{id}
- 上下架服务：PUT /api/v1/service/{id}/status
- 服务列表：GET /api/v1/service/list
- 服务详情：GET /api/v1/service/{id}

#### 6.2.5 需求管理接口

- 发布需求：POST /api/v1/demand
- 更新需求：PUT /api/v1/demand/{id}
- 取消需求：PUT /api/v1/demand/{id}/cancel
- 需求列表：GET /api/v1/demand/list
- 需求详情：GET /api/v1/demand/{id}

#### 6.2.6 订单管理接口

- 创建订单：POST /api/v1/order
- 支付订单：POST /api/v1/order/{id}/pay
- 确认订单：PUT /api/v1/order/{id}/confirm
- 取消订单：PUT /api/v1/order/{id}/cancel
- 完成服务：PUT /api/v1/order/{id}/complete
- 验收服务：PUT /api/v1/order/{id}/accept
- 订单列表：GET /api/v1/order/list
- 订单详情：GET /api/v1/order/{id}

#### 6.2.7 支付接口

- 创建支付：POST /api/v1/payment
- 支付回调：POST /api/v1/payment/callback
- 申请退款：POST /api/v1/payment/refund
- 支付记录：GET /api/v1/payment/list

#### 6.2.8 评价接口

- 提交评价：POST /api/v1/evaluation
- 评价列表：GET /api/v1/evaluation/list
- 评价详情：GET /api/v1/evaluation/{id}

#### 6.2.9 消息接口

- 获取消息列表：GET /api/v1/message/list
- 获取未读消息数：GET /api/v1/message/unread
- 标记消息已读：PUT /api/v1/message/read
- 发送消息：POST /api/v1/message/send
- 获取历史消息：GET /api/v1/message/history

#### 6.2.10 文件接口

- 上传文件：POST /api/v1/file/upload
- 获取文件：GET /api/v1/file/{id}
- 删除文件：DELETE /api/v1/file/{id}

#### 6.2.11 搜索接口

- 服务搜索：GET /api/v1/search/service
- 需求搜索：GET /api/v1/search/demand
- 附近服务：GET /api/v1/search/nearby

## 七、安全与合规方案

### 7.1 用户数据安全

- 敏感数据加密：用户密码、身份证号等敏感信息采用不可逆加密存储
- 传输加密：全站HTTPS，保障数据传输安全
- 数据脱敏：接口返回数据进行脱敏处理，如手机号、身份证号部分隐藏
- 权限控制：基于RBAC模型的权限管理，确保用户只能访问有权限的数据

### 7.2 支付安全

- 支付流程加密：支付全流程数据加密传输
- 资金托管：平台作为第三方，托管交易资金，确保交易安全
- 异常交易监控：实时监控异常交易行为，防范欺诈风险
- 支付通道冗余：对接多家支付渠道，确保支付系统高可用

### 7.3 无人机合规管理

- 资质审核：对接民航局UOM系统，自动核验无人机操作证、设备登记证
- 空域管理：内置全国空域地图，标注红区/蓝区/白区，确保飞行合规
- 飞行记录：记录无人机飞行日志，满足监管要求
- 实时监控：服务过程中实时监控无人机位置、状态，发现异常及时预警

### 7.4 系统安全防护

- 防SQL注入：使用参数化查询，避免SQL注入攻击
- 防XSS攻击：对用户输入进行过滤，防止跨站脚本攻击
- 防CSRF攻击：使用CSRF Token，防止跨站请求伪造
- 接口限流：对API接口进行限流，防止恶意请求
- 日志审计：记录关键操作日志，支持安全审计

## 八、部署与运维方案

### 8.1 部署架构

采用容器化部署方案，基于Kubernetes编排管理，主要包括以下环境：

- 开发环境：供开发人员开发测试使用
- 测试环境：供测试人员功能测试使用
- 预发布环境：与生产环境配置一致，用于上线前验证
- 生产环境：对外提供服务的正式环境

### 8.2 服务器配置

- 应用服务器：8核16G，10台
- 数据库服务器：16核32G，2台
- 缓存服务器：8核16G，2台
- 搜索服务器：8核16G，2台
- 消息队列服务器：8核16G，2台
- 监控服务器：4核8G，1台

### 8.3 高可用方案

- 应用层：多实例部署，负载均衡
- 数据库层：主从复制，读写分离
- 缓存层：Redis集群，哨兵模式
- 消息队列：RocketMQ集群
- 搜索引擎：Elasticsearch集群
- 存储层：分布式文件存储，多副本备份

### 8.4 监控告警

- 系统监控：CPU、内存、磁盘、网络等基础指标监控
- 应用监控：接口响应时间、错误率、QPS等应用指标监控
- 业务监控：订单量、支付成功率、用户活跃度等业务指标监控
- 告警机制：短信、邮件、钉钉等多渠道告警通知

### 8.5 灾备方案

- 数据备份：数据库每日全量备份，实时增量备份
- 多机房部署：核心服务跨机房部署，确保单机房故障不影响整体服务
- 故障演练：定期进行故障演练，验证灾备方案有效性
- 应急预案：制定完善的应急响应预案，明确故障处理流程

## 九、项目实施计划

### 9.1 开发周期

总周期：4个月

- 需求分析与设计：2周
- 开发阶段：10周
- 测试阶段：4周
- 上线准备：2周

### 9.2 团队配置

- 产品经理：1人
- 前端开发：2人
- 后端开发：4人
- 测试工程师：2人
- 运维工程师：1人
- 项目经理：1人

### 9.3 里程碑计划

- 第1周：完成需求分析与系统设计
- 第3周：完成数据库设计与核心接口定义
- 第6周：完成用户模块、认证模块开发
- 第9周：完成供给方模块、需求方模块开发
- 第12周：完成订单模块、支付模块开发
- 第14周：完成系统集成测试
- 第16周：系统上线

## 十、风险评估与应对策略

### 10.1 技术风险

- 地理位置服务精度不足：采用高德地图API，结合GPS、基站、WIFI等多种定位方式提高精度
- 实时通讯稳定性问题：使用融云IM SDK，结合心跳机制、断线重连等策略保障通讯稳定性
- 系统并发压力：采用微服务架构，服务水平扩展，结合缓存、限流等措施应对高并发

### 10.2 业务风险

- 供需匹配效率低：优化匹配算法，增加人工推荐通道，提高匹配效率
- 交易纠纷处理：建立完善的纠纷处理机制，设立专门客服团队处理纠纷
- 用户信任问题：实名认证、资质验证、信用评价体系，提升平台可信度

### 10.3 合规风险

- 无人机监管政策变化：密切关注政策动态，及时调整系统功能，确保合规
- 支付合规问题：对接正规支付渠道，遵循支付行业规范
- 数据安全合规：遵循《网络安全法》《数据安全法》《个人信息保护法》等法规要求

## 十一、扩展与演进规划

### 11.1 功能扩展规划

- 无人机培训服务：为需求方提供无人机操作培训服务
- 设备租赁服务：提供无人机设备租赁服务
- 保险服务：提供无人机责任险、设备险等保险服务
- 数据分析服务：提供航拍数据、巡检数据分析服务

### 11.2 技术演进规划

- AI智能调度：引入AI算法，优化供需匹配效率
- 区块链技术：应用于交易信任、合同签署等场景
- 边缘计算：提升无人机数据处理能力
- 5G技术：利用5G高带宽、低延迟特性，提升实时通讯、视频传输体验

### 11.3 商业模式演进

- 广告服务：为供给方提供广告投放服务
- 增值服务：提供数据存储、视频编辑等增值服务
- 企业解决方案：为大型企业提供定制化无人机服务解决方案
- 跨行业合作：与旅游、物流、农业等行业深度合作，拓展应用场景

## 十二、附录

### 12.1 技术选型详情

#### 12.1.1 前端技术栈详情

- UniApp：基于Vue.js的跨端开发框架，支持iOS、Android、H5等多端
- uView UI：UniApp生态优秀的UI组件库，提供丰富的组件和样式
- Vuex：Vue.js官方状态管理库，用于管理应用状态
- 高德地图API：提供地图显示、定位、路径规划等功能
- 融云IM SDK：提供即时通讯功能，支持单聊、群聊、系统通知等
- ECharts：功能强大的数据可视化库，用于展示统计数据

#### 12.1.2 后端技术栈详情

- Spring Boot：简化Spring应用开发的框架，提供自动配置、内嵌服务器等特性
- Spring Cloud Alibaba：阿里巴巴开源的微服务框架，提供服务注册发现、配置管理等功能
- Nacos：服务注册与发现、配置管理平台
- Spring Cloud Gateway：基于Spring WebFlux的API网关
- OpenFeign：声明式REST客户端，简化服务调用
- Sentinel：流量控制、熔断降级框架
- Seata：分布式事务解决方案
- RocketMQ：分布式消息队列，支持高可靠、高并发的消息处理
- Redis：内存数据库，用于缓存、会话管理等
- Elasticsearch：分布式搜索引擎，支持全文搜索、地理位置搜索
- MySQL：关系型数据库，存储结构化数据
- MyBatis-Plus：MyBatis的增强工具，简化数据库操作
- Sharding-JDBC：分库分表中间件，解决数据库扩展问题

### 12.2 接口示例

#### 12.2.1 登录接口

请求示例：

```http
POST /api/v1/auth/login HTTP/1.1
Content-Type: application/json

{
  "phone": "13800138000",
  "code": "123456"
}
```

响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 7200,
    "userInfo": {
      "id": 10001,
      "username": "user123",
      "phone": "138****8000",
      "userType": 1,
      "realName": "张**",
      "avatar": "https://example.com/avatar/10001.jpg",
      "creditScore": 95
    }
  },
  "timestamp": 1629782400000
}
```

#### 12.2.2 发布服务接口

请求示例：

```http
POST /api/v1/service HTTP/1.1
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "deviceId": 2001,
  "serviceType": 1,
  "serviceName": "专业航拍服务",
  "serviceDesc": "提供高清航拍服务，适用于婚礼、旅游、活动等场景",
  "priceType": 1,
  "price": 299.00,
  "serviceArea": {
    "type": "Polygon",
    "coordinates": [[[116.3, 39.9], [116.4, 39.9], [116.4, 40.0], [116.3, 40.0], [116.3, 39.9]]]
  },
  "serviceTime": {
    "monday": [{"start": "09:00", "end": "18:00"}],
    "tuesday": [{"start": "09:00", "end": "18:00"}],
    "wednesday": [{"start": "09:00", "end": "18:00"}],
    "thursday": [{"start": "09:00", "end": "18:00"}],
    "friday": [{"start": "09:00", "end": "18:00"}],
    "saturday": [{"start": "10:00", "end": "20:00"}],
    "sunday": [{"start": "10:00", "end": "20:00"}]
  }
}
```

响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 3001,
    "serviceNo": "S202208250001",
    "status": 1
  },
  "timestamp": 1629782400000
}
```

### 12.3 数据库表结构SQL

```sql
-- 用户表
CREATE TABLE `user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_type` tinyint(4) NOT NULL COMMENT '用户类型（1:个人,2:企业）',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码',
  `phone` varchar(20) NOT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `id_card` varchar(20) DEFAULT NULL COMMENT '身份证号',
  `company_name` varchar(100) DEFAULT NULL COMMENT '企业名称',
  `business_license` varchar(100) DEFAULT NULL COMMENT '营业执照号',
  `credit_score` int(11) DEFAULT '100' COMMENT '信用分',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态（0:禁用,1:正常）',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`),
  UNIQUE KEY `uk_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 资质认证表
CREATE TABLE `qualification` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `cert_type` tinyint(4) NOT NULL COMMENT '证书类型（1:操作证,2:设备登记证）',
  `cert_no` varchar(50) NOT NULL COMMENT '证书编号',
  `cert_image` varchar(200) NOT NULL COMMENT '证书图片URL',
  `valid_start` date NOT NULL COMMENT '有效期开始日期',
  `valid_end` date NOT NULL COMMENT '有效期结束日期',
  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '状态（0:待审核,1:已通过,2:未通过）',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_cert_no` (`cert_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='资质认证表';

-- 设备表
CREATE TABLE `device` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `device_name` varchar(100) NOT NULL COMMENT '设备名称',
  `device_model` varchar(100) NOT NULL COMMENT '设备型号',
  `device_sn` varchar(100) NOT NULL COMMENT '设备序列号',
  `register_no` varchar(100) DEFAULT NULL COMMENT '登记证编号',
  `device_type` tinyint(4) NOT NULL COMMENT '设备类型（1:航拍,2:货运,3:多功能）',
  `max_load` decimal(10,2) DEFAULT NULL COMMENT '最大载重（kg）',
  `max_flight_time` int(11) DEFAULT NULL COMMENT '最大飞行时间（分钟）',
  `max_flight_distance` int(11) DEFAULT NULL COMMENT '最大飞行距离（米）',
  `device_image` varchar(200) DEFAULT NULL COMMENT '设备图片URL',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态（0:禁用,1:正常）',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_device_sn` (`device_sn`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备表';
```

### 12.4 参考资料

- Spring Boot官方文档：https://spring.io/projects/spring-boot
- Spring Cloud Alibaba官方文档：https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html
- UniApp官方文档：https://uniapp.dcloud.io/
- 高德地图API文档：https://lbs.amap.com/api/webservice/guide/api/georegeo
- 民航局无人机管理规定：http://www.caac.gov.cn/