# 011-消息事件与状态机集成技术方案

## 目标
- 以事件驱动方式解耦订单、支付、索引更新等跨服务流程，保障最终一致性。

## 事件模型
- `order_events`: `ORDER_CREATED/PAID/CANCELLED/COMPLETED`
- `payment_events`: `PAYMENT_CREATED/SUCCESS/FAILED/REFUNDED`
- `index_events`: `SUPPLY_PUBLISHED/UNPUBLISHED/UPDATED`, `DEMAND_PUBLISHED/UPDATED`

## 流程集成
- 订单创建 → 发布 `ORDER_CREATED` → 消费端触发支付待办与日志；
- 支付成功 → 发布 `PAYMENT_SUCCESS` → 更新订单状态 → 推送通知；
- 上架/更新 → 发布 `index_events` → 搜索服务更新索引。

## 幂等与重试
- 幂等键：`entity_id + event_type + version`；DLQ，定时重试与告警。

## 验收标准
- 在网络异常下事件仍最终送达；重复事件不破坏状态机。