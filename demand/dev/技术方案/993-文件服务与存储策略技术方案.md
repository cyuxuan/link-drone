# 文件服务与存储策略技术方案

## 目标
- 提供可靠的上传/下载/预览能力，支持大文件分片、断点续传与权限控制。

## 技术选型
- 存储：`MinIO`（本地/私有云）或 `Aliyun OSS`（公有云）。
- 依赖：`Spring Boot`、`spring-cloud`、`MinIO SDK` / `OSS SDK`。

## 接口设计
- `POST /file/upload`：表单直传（小文件）、分片初始化（大文件）。
- `POST /file/upload/chunk`：分片上传（带 `chunkNo/MD5`）。
- `POST /file/upload/merge`：服务端合并分片，校验 MD5。
- `GET /file/download/{id}`：下载（鉴权校验）。
- `GET /file/sign`：返回限时签名 URL（只读/私有对象）。

## 存储与权限
- 多桶策略：`public`（公开资源）、`private`（需签名访问）。
- 元数据表：`file(id, filename, size, md5, bucket, objectKey, ownerId, visibility, createdAt)`。
- 清理策略：孤儿分片回收、过期签名自动失效。

## 大文件与可靠性
- 分片大小：默认 5–10MB；并发上传与限速控制。
- 失败重试：指数退避；服务端合并时校验完整性。

## 验收标准
- 支持 2GB 文件的稳定上传；签名链接可控、鉴权生效。