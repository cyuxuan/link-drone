# 核心领域业务实现技术方案（用户/供给/需求/订单/支付）

## 目标
- 建立统一的领域模型与分层架构，实现基础 CRUD、校验与事务一致性。

## 技术选型
- `Spring Boot`、`MyBatis-Plus`、`MySQL`、`Bean Validation`、`MapStruct`（DTO 映射）。

## 分层设计
- `controller` (DTO/VO) → `service` (领域规则/事务) → `domain` (entity) → `repository` (mapper)。
- 规范返回体（`code/message/data`），统一异常处理（`@ControllerAdvice`）。

## 领域与接口（概述）
- 用户：注册/修改资料/查询/禁用。
- 供给：发布供给信息、上下架、定价与容量管理。
- 需求：发布需求信息、匹配供给、状态流转。
- 订单：创建/支付/取消/完成，订单状态机与审计。
- 支付：支付下单/回调/退款，对账与幂等。

## 校验与事务
- 参数校验：`@Valid` + 分组；业务校验在 `service` 层。
- 事务：下单与支付采用幂等键 + 唯一约束；跨服务用事件驱动（最终一致）。

## 数据模型（简要）
- `user(id, name, phone, email, status)`
- `supply(id, provider_id, title, capacity, price, status)`
- `demand(id, requester_id, title, quantity, budget, status)`
- `order(id, supply_id, demand_id, status, amount, created_at)`
- `payment(id, order_id, status, channel, txn_id, amount)`

## 事件与集成
- 订单事件：`ORDER_CREATED/PAID/CANCELLED/COMPLETED` → 消息服务广播。
- 搜索：供给/需求上架变更触发索引更新。

## 验收标准
- 每个领域的 CRUD + 业务流程用例覆盖；
- 状态机保持一致性，订单/支付幂等且可恢复。