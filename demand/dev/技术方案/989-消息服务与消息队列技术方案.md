# 消息服务与消息队列技术方案

## 目标
- 构建事件驱动架构，支撑订单/支付/索引更新等跨服务解耦与最终一致性。

## 技术选型
- `RocketMQ`（优先）或 `Kafka`；`Spring Cloud Stream` 集成。

## 主题与消息模型
- `order_events`：`ORDER_CREATED/PAID/CANCELLED/COMPLETED`。
- `payment_events`：`PAYMENT_CREATED/SUCCESS/FAILED/REFUNDED`。
- `index_events`：供给/需求上架/下架/更新。
- 消息结构：`event_type`, `entity_id`, `payload`, `trace_id`, `occurred_at`。

## 可靠性与重试
- 幂等键：`entity_id + event_type + version`。
- 重试策略：DLQ（死信队列）、定时重试、告警。
- 有序性：重要事件采用顺序消息（按 `entity_id` 分区）。

## 运维与监控
- 生产/消费 TPS 监控、积压告警、失败率阈值报警。

## 验收标准
- 订单/支付事件在异常网络下仍能最终送达；重复消息不导致状态错误。