# 网关鉴权过滤与白名单技术方案

## 目标
- 在网关统一执行鉴权校验与白名单策略，向下游透传用户身份与权限信息。

## 技术选型
- `Spring Cloud Gateway` 自定义 `GlobalFilter`；`spring-security` 资源服务器模式。

## 白名单策略
- 允许匿名：`/api/auth/login`, `/api/auth/refresh`, `/api/**/ping`, 静态资源。
- 其他接口默认要求 `Authorization: Bearer <token>`。

## 鉴权过滤器流程
1. 读取 `Authorization` 头并解析 JWT（校验签名与过期）。
2. 提取 `userId/roles/tenant`，注入到请求头 `X-User-Id`, `X-User-Roles`。
3. 黑名单与撤销检查（Redis）。
4. 失败时返回 `401/403` 带错误码，成功则继续路由。

## 细粒度授权（可选）
- 依据网关路由 `id` + 下游 `resource/action` 进行预授权，减少下游负担。

## 运维与安全
- 支持鉴权开关与灰度；限速前置（与限流策略协同）。

## 验收标准
- 白名单接口免鉴权；携带有效 Token 的请求能透传用户身份并被下游识别。