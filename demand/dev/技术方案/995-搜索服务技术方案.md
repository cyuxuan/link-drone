# 搜索服务技术方案

## 目标
- 基于 Elasticsearch 提供供给/需求的搜索与筛选，支持分页、排序、多条件过滤。

## 技术选型
- `Elasticsearch 7/8`、`Spring Data Elasticsearch`、`Nacos` 配置。

## 索引与映射
- 索引：`supply_index`、`demand_index`。
- 字段：`title(text, analyzer)`, `location(geo_point)`, `price(double)`, `capacity(integer)`, `status(keyword)`, `tags(keyword)`。
- 分词器：中文分词（如 `ik_smart`）。

## 数据同步
- 同步源：供给/需求服务的上架/更新/下架事件。
- 方式：直接调用 + 异步消息（优先异步，保证最终一致）。

## 接口设计
- `POST /search/supply`：复杂查询（关键词+范围+地理距离）。
- `POST /search/demand`：同上。
- `POST /search/reindex`：重建索引（管理员）。

## 性能与可用性
- 查询缓存、字段压缩；分页深度限制与 `search_after`。
- 批量写入与重试机制；失败记录与补偿任务。

## 验收标准
- 在 10w 级文档下，P95 查询延迟 < 200ms；索引更新延迟 < 3s。