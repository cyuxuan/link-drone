# 002-令牌刷新与登出技术方案

## 目标
- 提供安全的令牌刷新与登出机制，支持令牌旋转与黑名单撤销。

## 业务流程
- 刷新：校验 `refresh_token` → 生成新 `access_token` 与新 `refresh_token` → 旧 `refresh_token` 入黑名单。
- 登出：校验会话 → 将当前 `access_token/refresh_token` 写入黑名单 → 清理会话缓存。

## 接口设计
- `POST /auth/refresh`：入参 `refresh_token`，响应新令牌与过期时间。
- `POST /auth/logout`：入参当前 `access_token`，响应成功。

## 数据模型
- Redis：`jwt:blacklist:{jti}`，`jwt:session:{userId}`；字段含过期时间与设备指纹。

## 安全策略
- 令牌旋转（每次刷新签发新 `refresh_token`）；绑定设备指纹；撤销后立即失效。

## 边界与异常
- 多端登录冲突；过期刷新拒绝；时钟漂移导致的边界过期。

## 验收标准
- 刷新后旧令牌不可用；登出后所有端口令牌失效；审计日志完整。