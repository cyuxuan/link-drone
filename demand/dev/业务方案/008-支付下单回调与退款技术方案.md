# 008-支付下单回调与退款技术方案

## 目标
- 支持多支付渠道的下单、回调与退款流程，保证幂等与安全。

## 业务流程
- 支付下单：创建支付记录 → 调用渠道 → 返回支付链接或二维码。
- 回调：校验签名 → 更新支付状态 → 触发订单状态变化。
- 退款：校验可退款 → 请求渠道退款 → 更新状态与对账。

## 接口设计
- `POST /payment/create`，`POST /payment/callback/{channel}`，`POST /payment/{id}/refund`。

## 数据模型
- `payment(id, order_id, channel, status, amount, txn_id, created_at)`
- `refund(id, payment_id, amount, status, reason, created_at)`

## 幂等与安全
- 幂等键：`order_id + channel`；回调签名校验；通知重试与去重。

## 验收标准
- 渠道回调稳定；重复回调不导致重复入账；退款与对账一致。