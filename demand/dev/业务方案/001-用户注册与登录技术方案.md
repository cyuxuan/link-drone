# 001-用户注册与登录技术方案

## 目标
- 提供安全、可扩展的注册与登录能力，支持账号/手机号/邮箱登录，后续支持三方登录。

## 业务流程
- 注册：校验唯一性 → 生成密码哈希 → 初始化角色 → 创建用户。
- 登录：校验凭证 → 记录登录日志 → 签发 Access/Refresh Token → 返回会话信息。

## 接口设计
- `POST /auth/register`：请求含 `username/password/phone/email`，响应 `userId`。
- `POST /auth/login`：`username/password` 或 `phone+code`，响应 `access_token/refresh_token/expires_in`。
- `GET /auth/profile`：返回基本资料与角色。

## 数据模型
- `user(id, username, password_hash, phone, email, status, created_at)`
- `user_role(user_id, role)`，`login_log(user_id, ip, ua, success, created_at)`

## 安全策略
- `BCrypt` 密码哈希；登录失败次数限制与滑动窗口；验证码（短信/图形）。
- 敏感字段脱敏与加密；统一返回错误码；防暴力破解与爆破告警。

## 边界与异常
- 并发注册唯一性冲突（唯一索引）；弱密码拒绝；登录锁定后解锁策略。

## 验收标准
- 完成注册/登录/资料查询流程测试；登录日志可追踪；安全策略生效。