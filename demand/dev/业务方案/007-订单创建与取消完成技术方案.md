# 007-订单创建与取消完成技术方案

## 目标
- 完成供需撮合后，支持订单创建、取消与完成的标准化状态流转。

## 业务流程
- 创建：校验供需有效 → 计算金额 → 写入订单 → 触发支付待办。
- 取消：校验可取消状态 → 更新状态 → 触发退款（如已支付）。
- 完成：校验履约成功 → 更新状态 → 记录评价（可选）。

## 状态机
- `CREATED → PAID → IN_PROGRESS → COMPLETED`，
- `CREATED → CANCELLED`，`PAID → REFUNDING → REFUNDED`。

## 接口设计
- `POST /order`，`POST /order/{id}/cancel`，`POST /order/{id}/complete`，`GET /order/{id}`。

## 数据模型
- `order(id, demand_id, supply_id, amount, status, created_at)`
- `order_audit(order_id, action, operator, note, created_at)`

## 幂等与事务
- 幂等键：`demand_id + supply_id + created_at`；唯一索引防重复下单。

## 验收标准
- 状态流转严格；审计完整；并发下单不会重复。