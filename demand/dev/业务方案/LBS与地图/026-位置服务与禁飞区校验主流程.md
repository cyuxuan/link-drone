# 026-位置服务与禁飞区校验主流程

本流程定义位置与地图相关的主路径，确保选址与执行阶段遵守禁飞区与安全规范。

## 1. 目标与范围
- 为需求与供给提供地理选址、范围圈定与路径规划辅助。
- 在发布、匹配、订单创建与执行阶段进行禁飞区/限高/时间窗校验。

## 2. 参与角色
- 需求方/供给方：选择地点与范围，查看风险提示。
- 系统：地理索引、禁飞区校验、风险评估与提示。

## 3. 前置条件
- 导入禁飞区与限高数据，支持定期更新与版本管理。
- 建立地理索引与坐标转换（WGS84/GCJ-02 等）。

## 4. 主流程
1) 选址与范围
- 需求/供给在地图选点或圈定范围；系统返回基础信息（行政区、地形、附近风险）。

2) 发布与匹配校验
- 在发布与匹配时进行禁飞区/限高校验；冲突时阻止或提醒调整。

3) 订单创建校验
- 创建订单前再次校验；给出可行建议（时间窗变更、范围缩小、替代附近）。

4) 执行阶段校验
- 执行时持续检查轨迹与位置，在进入禁飞区前预警并建议绕行或中止。

## 5. 状态与事件
- 状态：地点 `valid/invalid`；风险 `low/medium/high`。
- 事件：`GeoChecked`、`NoFlyConflictFound`、`RiskAlert`、`RouteAdjusted`。

## 6. 接口映射（示例）
- `POST /api/geo/check` 校验禁飞区与风险
- `GET  /api/geo/no-fly-zones` 获取禁飞区数据
- `POST /api/geo/route` 路径规划（含风险规避）

## 7. 数据与校验
- 模型：`geo_index`、`no_fly_zone`、`risk_area`、`route_plan`。
- 校验：坐标合法性、范围大小限制、禁飞区/限高匹配、风险分级。

## 8. 异常与回滚
- 数据过期：版本回退与增量更新；提示用户风险。
- 坐标不合法：拦截并提示重选。

## 9. 审计与合规
- 审计：校验结果、风险提示与用户操作记录。
- 合规：安全合规与地方监管要求遵守（按地区差异化）。

## 10. 验收标准
- 选址-发布-匹配-订单-执行各阶段校验生效；
- 风险提示清晰且可操作，路径规划可避让禁飞区。